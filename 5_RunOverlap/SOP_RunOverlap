# Author J.Connolly updated Oct 2019, august 2019, Summer 2018
# Internal deliberative, do not cite or distribute

When unioned species files are finalize and use layers have been moved to library in the correct projection
the overlap runs can be started; output raw overlap for each use site by region, species group

Key variable - Use layers and Species files are in the same projections; cell size for use layer is identified
Updates will need to occur if: use  layer or species range files change, projection is off

Key Tracking : Root folder for output file locations need to remain consistent for all runs.  File structure
is automated.

Inputs:
  Tables:
	- Master species list
	- Species acres tables by region
	- Species/Zone Look-up tables
	- Use Layer Look-up
	- Usage Tables
  Spatial Data:
	- Projections
	- Snap rasters (identified in dictionary)
	- Species Unioned Composite Files
	- Use Layer Library by region
	- Region Boundaries
	- NHDPlus - HUC12 (aquatic species only)
  For Usage only:

  Tables:
	- Crop Name/Data source crosswalk
	- Census of Ag tables
		- presences/absences county masks
		- Master crop/state combination table
	- SUUM/ Aggregated PCT by State
   Spatial Data:
	- County Boundaries
	- HUC boundaries
	- Other GIS data to consider (elevation, habitat, on/off field layers, etc)

Outputs: Note-  Root folder for output file locations need to remain consistent for all runs.  File structure
is automated.
	- Raw overlap by Zone

** Be sure to update the snap raster dictionary as well
***KEY ASSUMPTION All use layer must start with the projection name follow by the regions abbreviation or CDL and then
the use with the _euc if is distance raster

Step 1 - General overlap for species range and CH unioned files; can be used for varied unique IDs; ie ZoneID, InterID etc
    NOTE - Temp files will sometime save in the in_species location - these are grids that start with t_ - this can
    cause the script to stop saving output - these files should be deleted )- TODO figure out why these temp files are saved
    - Runs by region
    - Run multiple regions at the same time - regions takes less time than CONUS ~ 1.5 hours per use for CONUS
        - To speed up CONUS runs use the sub-set use variable and run the uses in groups rather than the whole gdb
    - When running input files with habitat, elevation, states and HUC birds, fish, mammals, flowering plants amphibians
    take a long time; fish is the longest.
    - Batch by regions and groups of species to minimize run time. sometimes these
    files require more memory than the computer has.  These runs can be done in the lab or try running only one
    instance at a time
    TODO look at splitting input files into multiple grids with only 1,000,000 unique zone
    - Output is msq distance is row wise zone for species is column wise

Step 2- Overlap for aquatic species based on catchment: - ON HOLD
    - Runs by region
    -Output is pixel count catchment ID is row wise and distance is column wise - transformed so there wouldn't be
    millions of columns  easier to have millions of row
    #TODO - update needs to be finalized for Step 2 needs;; can we simplify?

Step 2b- Overlap for aquatic species based HUC12: - ON HOLD
    - ON HOLD
    - Runs by region
    - Original overlap for NHD when just doing HUC - likely will be archived
        - NOTE HAS NOT BEEN updated if we start to use this one again inputs should be streamlined to match others
        in this tool

Step 3 - Run overlap against political boundaries used for usage :
    - Results are only needed for usage see ApplyUsage SOP
    -Note - when running the overlap for species and political boundaries at the same time, if the same use layer is
    accessed at the same time a 99999 error may occur; re-start the script if this occurs

Step 4 - Place holder for running a vector use:
    # TODO finished this script then update table automation to account for a vector use

# NOTES
# ## Check path of the temp location for raster layers

# arcpy.Delete_management( "in_memory" + os.sep + "zone_lyr")
# dir_name = os.path.dirname(zone_lyr)
# arcpy.MakeRasterLayer_management(zone_lyr, dir_name  + os.sep + "zone_lyr")
# print [f.name for f in arcpy.ListFields( dir_name  + os.sep + "zone_lyr")]
# desc= arcpy.Describe( dir_name + os.sep + "zone_lyr")
# print("Feature Class: " +desc.dataElement.catalogPath)

# Each region is a list pos 0 euc distance, pos 1 on/off, pos 2 Yearly (CONUS only)
# used with zonal histogram vs tabulate area
# symbology_dict = {'CONUS': [
#     r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\Albers_Conical_Equal_Area_CDL_1016_110x2_euc.lyr',
#     r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\Albers_Conical_Equal_Area_OnOff_X7072_171227.lyr',
#     r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\Albers_Conical_Equal_Area_CDL_2010_rec.lyr'],
#     'HI': [r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\NAD_1983_UTM_Zone_4N_HI_Ag_euc.lyr',
#            r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\NAD_1983_UTM_Zone_4N_CCAP_HI_6.lyr'],
#     'AK': [r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\WGS_1984_Albers_AK_Ag_euc.lyr',
#            r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\WGS_1984_Albers_AK_NLCD_2011_81.lyr'],
#     'AS': [r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\WGS_1984_UTM_Zone_2S_AS_Ag_euc.lyr',
#            r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\WGS_1984_UTM_Zone_2S_CCAP_AS_6.lyr'],
#     'CNMI': [r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\WGS_1984_UTM_Zone_55N_CNMI_Ag_euc.lyr',
#              r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\WGS_1984_UTM_Zone_55N_CCAP_CNMI_6.lyr'],
#     'GU': [r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\WGS_1984_UTM_Zone_55N_GU_Ag_euc.lyr',
#            r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\WGS_1984_UTM_Zone_55N_CCAP_GU_6_30.lyr'],
#     'PR': [r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\Albers_Conical_Equal_Area_PR_Ag_euc.lyr',
#            r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\Albers_Conical_Equal_Area_PR_NLCD_81.lyr'],
#     'VI': [r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\WGS_1984_UTM_Zone_20N_VI_Ag_euc.lyr',
#            r'L:\Workspace\StreamLine\ByProjection\Symbol_Layers\WGS_1984_UTM_Zone_20N_CCAP_VI_6_30.lyr']}